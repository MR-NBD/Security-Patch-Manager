<mxfile host="draw.io" agent="Claude Code" version="28.2.8">
  <diagram name="SPM Flask API Architecture" id="flask-api-arch">
    <mxGraphModel dx="2000" dy="1200" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="&lt;b&gt;SPM Flask API v2.6 - Architecture &amp; Endpoint Map&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=18;fontColor=#333333;" parent="1" vertex="1">
          <mxGeometry x="500" y="20" width="500" height="30" as="geometry" />
        </mxCell>

        <!-- External Data Sources Box -->
        <mxCell id="ext-sources-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#666666;fillColor=#FFF2CC;dashed=1;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="40" y="70" width="300" height="250" as="geometry" />
        </mxCell>
        <mxCell id="ext-sources-title" value="&lt;b&gt;External Data Sources&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="100" y="80" width="180" height="20" as="geometry" />
        </mxCell>

        <!-- USN Source -->
        <mxCell id="usn-source" value="&lt;b&gt;Ubuntu Security Notices&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;ubuntu.com/security/notices.json&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE6CC;strokeColor=#D79B00;" parent="1" vertex="1">
          <mxGeometry x="60" y="110" width="130" height="50" as="geometry" />
        </mxCell>

        <!-- DSA Source -->
        <mxCell id="dsa-source" value="&lt;b&gt;Debian Security Tracker&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;security-tracker.debian.org/json&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE6CC;strokeColor=#D79B00;" parent="1" vertex="1">
          <mxGeometry x="200" y="110" width="130" height="50" as="geometry" />
        </mxCell>

        <!-- NVD Source -->
        <mxCell id="nvd-source" value="&lt;b&gt;NVD API 2.0&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;services.nvd.nist.gov/rest/json/cves&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE6CC;strokeColor=#D79B00;" parent="1" vertex="1">
          <mxGeometry x="60" y="170" width="130" height="50" as="geometry" />
        </mxCell>

        <!-- OVAL Source -->
        <mxCell id="oval-source" value="&lt;b&gt;OVAL Definitions&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;canonical.com + debian.org/oval&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE6CC;strokeColor=#D79B00;" parent="1" vertex="1">
          <mxGeometry x="200" y="170" width="130" height="50" as="geometry" />
        </mxCell>

        <!-- Rate Limit Info -->
        <mxCell id="rate-info" value="&lt;font style=&quot;font-size:8px&quot;&gt;&lt;b&gt;Rate Limits:&lt;/b&gt;&lt;br&gt;USN: 0.5s delay&lt;br&gt;NVD: 0.6s (API key) / 6s (no key)&lt;br&gt;DSA: Single JSON download (~63MB)&lt;br&gt;OVAL: bz2 compressed XML&lt;/font&gt;" style="text;html=1;strokeColor=#D79B00;fillColor=#FFF2CC;align=left;verticalAlign=top;rounded=1;fontSize=9;spacingLeft=5;spacingTop=5;" parent="1" vertex="1">
          <mxGeometry x="60" y="235" width="270" height="70" as="geometry" />
        </mxCell>

        <!-- Flask Application Container -->
        <mxCell id="flask-container-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#0066CC;fillColor=#DAE8FC;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="380" y="70" width="800" height="580" as="geometry" />
        </mxCell>
        <mxCell id="flask-title" value="&lt;b&gt;Flask Application (Gunicorn WSGI)&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;Container: aci-errata-api | Port: 5000 | Workers: 2&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="580" y="80" width="400" height="40" as="geometry" />
        </mxCell>

        <!-- Configuration Block -->
        <mxCell id="config-block" value="&lt;b&gt;Configuration&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;DATABASE_URL (env)&lt;br&gt;UYUNI_URL / USER / PASSWORD&lt;br&gt;NVD_API_KEY&lt;br&gt;OVAL_SOURCES (dict)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673A6;align=left;spacingLeft=10;" parent="1" vertex="1">
          <mxGeometry x="400" y="130" width="170" height="90" as="geometry" />
        </mxCell>

        <!-- Utility Functions Block -->
        <mxCell id="utils-block" value="&lt;b&gt;Utility Functions&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;get_db() → psycopg2 conn&lt;br&gt;get_uyuni_client() → XML-RPC&lt;br&gt;calculate_severity(cvss)&lt;br&gt;map_channel_to_distribution()&lt;br&gt;version_compare() [FIX #1]&lt;br&gt;@retry_with_backoff [FIX #6]&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673A6;align=left;spacingLeft=10;" parent="1" vertex="1">
          <mxGeometry x="590" y="130" width="180" height="110" as="geometry" />
        </mxCell>

        <!-- Logging Block -->
        <mxCell id="logging-block" value="&lt;b&gt;Logging&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;stdout + file&lt;br&gt;/var/log/errata-manager.log&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673A6;" parent="1" vertex="1">
          <mxGeometry x="790" y="130" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- P3 Module Integration -->
        <mxCell id="p3-module" value="&lt;b&gt;P3 Patch Testing Module&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;from p3_patch_testing import register_p3_blueprint&lt;br&gt;Loaded at startup if available&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;align=center;" parent="1" vertex="1">
          <mxGeometry x="950" y="130" width="210" height="60" as="geometry" />
        </mxCell>

        <!-- API Endpoints Section -->
        <mxCell id="endpoints-section" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#82B366;fillColor=#D5E8D4;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="400" y="250" width="760" height="380" as="geometry" />
        </mxCell>
        <mxCell id="endpoints-title" value="&lt;b&gt;API Endpoints&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="700" y="255" width="160" height="25" as="geometry" />
        </mxCell>

        <!-- Health Endpoints -->
        <mxCell id="health-group" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#6C8EBF;fillColor=#DAE8FC;dashed=1;" parent="1" vertex="1">
          <mxGeometry x="420" y="285" width="170" height="130" as="geometry" />
        </mxCell>
        <mxCell id="health-title" value="&lt;b&gt;Health &amp; Stats&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="450" y="290" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="ep-health" value="&lt;font style=&quot;font-size:9px&quot;&gt;GET /api/health&lt;br&gt;→ api, db, uyuni status&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#6C8EBF;align=left;spacingLeft=5;" parent="1" vertex="1">
          <mxGeometry x="430" y="315" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ep-health-detail" value="&lt;font style=&quot;font-size:9px&quot;&gt;GET /api/health/detailed&lt;br&gt;→ errata stats, sync age, alerts&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#6C8EBF;align=left;spacingLeft=5;" parent="1" vertex="1">
          <mxGeometry x="430" y="350" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ep-stats" value="&lt;font style=&quot;font-size:9px&quot;&gt;GET /api/stats/overview&lt;br&gt;GET /api/stats/packages&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#6C8EBF;align=left;spacingLeft=5;" parent="1" vertex="1">
          <mxGeometry x="430" y="385" width="150" height="25" as="geometry" />
        </mxCell>

        <!-- Sync Endpoints -->
        <mxCell id="sync-group" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#D79B00;fillColor=#FFE6CC;dashed=1;" parent="1" vertex="1">
          <mxGeometry x="610" y="285" width="175" height="175" as="geometry" />
        </mxCell>
        <mxCell id="sync-title" value="&lt;b&gt;Sync Endpoints&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="640" y="290" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="ep-sync-usn" value="&lt;font style=&quot;font-size:9px&quot;&gt;&lt;b&gt;POST&lt;/b&gt; /api/sync/usn&lt;br&gt;→ Incremental [FIX #4]&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#D79B00;align=left;spacingLeft=5;" parent="1" vertex="1">
          <mxGeometry x="620" y="315" width="155" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ep-sync-dsa" value="&lt;font style=&quot;font-size:9px&quot;&gt;&lt;b&gt;POST&lt;/b&gt; /api/sync/dsa/full&lt;br&gt;→ Auto batch [FIX #5]&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#D79B00;align=left;spacingLeft=5;" parent="1" vertex="1">
          <mxGeometry x="620" y="350" width="155" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ep-sync-nvd" value="&lt;font style=&quot;font-size:9px&quot;&gt;&lt;b&gt;POST&lt;/b&gt; /api/sync/nvd&lt;br&gt;?batch_size=&amp;prioritize=&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#D79B00;align=left;spacingLeft=5;" parent="1" vertex="1">
          <mxGeometry x="620" y="385" width="155" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ep-sync-oval" value="&lt;font style=&quot;font-size:9px&quot;&gt;&lt;b&gt;POST&lt;/b&gt; /api/sync/oval&lt;br&gt;?platform= [FIX #2]&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#D79B00;align=left;spacingLeft=5;" parent="1" vertex="1">
          <mxGeometry x="620" y="420" width="155" height="30" as="geometry" />
        </mxCell>

        <!-- Errata Endpoints -->
        <mxCell id="errata-group" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#82B366;fillColor=#D5E8D4;dashed=1;" parent="1" vertex="1">
          <mxGeometry x="805" y="285" width="165" height="100" as="geometry" />
        </mxCell>
        <mxCell id="errata-title" value="&lt;b&gt;Errata Endpoints&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="830" y="290" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="ep-errata-list" value="&lt;font style=&quot;font-size:9px&quot;&gt;GET /api/errata&lt;br&gt;?limit, source, severity...&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#82B366;align=left;spacingLeft=5;" parent="1" vertex="1">
          <mxGeometry x="815" y="315" width="145" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ep-errata-pkg" value="&lt;font style=&quot;font-size:9px&quot;&gt;GET /api/errata/{id}/packages&lt;br&gt;→ Package details&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#82B366;align=left;spacingLeft=5;" parent="1" vertex="1">
          <mxGeometry x="815" y="350" width="145" height="30" as="geometry" />
        </mxCell>

        <!-- UYUNI Endpoints -->
        <mxCell id="uyuni-group" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#B85450;fillColor=#F8CECC;dashed=1;" parent="1" vertex="1">
          <mxGeometry x="990" y="285" width="155" height="175" as="geometry" />
        </mxCell>
        <mxCell id="uyuni-title" value="&lt;b&gt;UYUNI Endpoints&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="1010" y="290" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="ep-uyuni-status" value="&lt;font style=&quot;font-size:9px&quot;&gt;GET /api/uyuni/status&lt;br&gt;→ version, channels, systems&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#B85450;align=left;spacingLeft=5;" parent="1" vertex="1">
          <mxGeometry x="1000" y="315" width="135" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ep-uyuni-channels" value="&lt;font style=&quot;font-size:9px&quot;&gt;GET /api/uyuni/channels&lt;br&gt;→ List with distribution map&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#B85450;align=left;spacingLeft=5;" parent="1" vertex="1">
          <mxGeometry x="1000" y="350" width="135" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ep-uyuni-sync" value="&lt;font style=&quot;font-size:9px&quot;&gt;&lt;b&gt;POST&lt;/b&gt; /api/uyuni/sync-packages&lt;br&gt;→ Cache UYUNI packages&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#B85450;align=left;spacingLeft=5;" parent="1" vertex="1">
          <mxGeometry x="1000" y="385" width="135" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ep-uyuni-push" value="&lt;font style=&quot;font-size:9px&quot;&gt;&lt;b&gt;POST&lt;/b&gt; /api/uyuni/push&lt;br&gt;→ Push errata [FIX #1]&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#B85450;align=left;spacingLeft=5;" parent="1" vertex="1">
          <mxGeometry x="1000" y="420" width="135" height="30" as="geometry" />
        </mxCell>

        <!-- Sync Status -->
        <mxCell id="sync-status-ep" value="&lt;font style=&quot;font-size:9px&quot;&gt;GET /api/sync/status → Last 20 sync logs&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#666666;align=center;" parent="1" vertex="1">
          <mxGeometry x="420" y="475" width="250" height="25" as="geometry" />
        </mxCell>

        <!-- Internal Flow Section -->
        <mxCell id="internal-flow-title" value="&lt;b&gt;Internal Processing Flow&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="560" y="510" width="180" height="20" as="geometry" />
        </mxCell>

        <!-- Request Flow -->
        <mxCell id="flow-request" value="&lt;b&gt;Request&lt;/b&gt;" style="ellipse;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82B366;" parent="1" vertex="1">
          <mxGeometry x="420" y="540" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="flow-cors" value="&lt;font style=&quot;font-size:9px&quot;&gt;CORS&lt;br&gt;Middleware&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673A6;" parent="1" vertex="1">
          <mxGeometry x="510" y="545" width="70" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow-retry" value="&lt;font style=&quot;font-size:9px&quot;&gt;@retry_with_&lt;br&gt;backoff&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673A6;" parent="1" vertex="1">
          <mxGeometry x="600" y="545" width="70" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow-handler" value="&lt;font style=&quot;font-size:9px&quot;&gt;Route&lt;br&gt;Handler&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE6CC;strokeColor=#D79B00;" parent="1" vertex="1">
          <mxGeometry x="690" y="545" width="70" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow-db" value="&lt;font style=&quot;font-size:9px&quot;&gt;PostgreSQL&lt;br&gt;(psycopg2)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;" parent="1" vertex="1">
          <mxGeometry x="780" y="545" width="70" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow-external" value="&lt;font style=&quot;font-size:9px&quot;&gt;External&lt;br&gt;API/UYUNI&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;" parent="1" vertex="1">
          <mxGeometry x="870" y="545" width="70" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow-response" value="&lt;b&gt;JSON&lt;/b&gt;" style="ellipse;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82B366;" parent="1" vertex="1">
          <mxGeometry x="960" y="540" width="70" height="40" as="geometry" />
        </mxCell>

        <!-- Flow Arrows -->
        <mxCell id="arr1" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="490" y="560" as="sourcePoint" />
            <mxPoint x="510" y="560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arr2" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="580" y="560" as="sourcePoint" />
            <mxPoint x="600" y="560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arr3" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="670" y="560" as="sourcePoint" />
            <mxPoint x="690" y="560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arr4" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="760" y="560" as="sourcePoint" />
            <mxPoint x="780" y="560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arr5" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="850" y="560" as="sourcePoint" />
            <mxPoint x="870" y="560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arr6" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="940" y="560" as="sourcePoint" />
            <mxPoint x="960" y="560" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Connection to External Sources -->
        <mxCell id="conn-usn" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#D79B00;strokeWidth=2;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="ep-sync-usn" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="190" y="135" as="sourcePoint" />
            <mxPoint x="610" y="325" as="targetPoint" />
            <Array as="points">
              <mxPoint x="370" y="135" />
              <mxPoint x="370" y="330" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="conn-dsa" value="" style="endArrow=classic;html=1;rounded=0;strokeColor=#D79B00;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="330" y="135" as="sourcePoint" />
            <mxPoint x="620" y="365" as="targetPoint" />
            <Array as="points">
              <mxPoint x="360" y="135" />
              <mxPoint x="360" y="365" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Database Box -->
        <mxCell id="db-container" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#6C8EBF;fillColor=#DAE8FC;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="40" y="340" width="300" height="310" as="geometry" />
        </mxCell>
        <mxCell id="db-title" value="&lt;b&gt;PostgreSQL Database&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;pg-errata-test.postgres.database.azure.com&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="60" y="350" width="260" height="30" as="geometry" />
        </mxCell>

        <!-- Tables -->
        <mxCell id="tbl-errata" value="&lt;b&gt;errata&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:8px&quot;&gt;116,261 records&lt;br&gt;advisory_id, title, severity,&lt;br&gt;source, distribution, sync_status&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#6C8EBF;align=left;spacingLeft=5;verticalAlign=top;spacingTop=5;" parent="1" vertex="1">
          <mxGeometry x="55" y="390" width="130" height="70" as="geometry" />
        </mxCell>
        <mxCell id="tbl-cves" value="&lt;b&gt;cves&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:8px&quot;&gt;47,845 records&lt;br&gt;cve_id&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#6C8EBF;align=left;spacingLeft=5;verticalAlign=top;spacingTop=5;" parent="1" vertex="1">
          <mxGeometry x="200" y="390" width="130" height="50" as="geometry" />
        </mxCell>
        <mxCell id="tbl-cve-details" value="&lt;b&gt;cve_details&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:8px&quot;&gt;cvss_v3_score, severity&lt;br&gt;cwe_ids, description&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#6C8EBF;align=left;spacingLeft=5;verticalAlign=top;spacingTop=5;" parent="1" vertex="1">
          <mxGeometry x="200" y="445" width="130" height="55" as="geometry" />
        </mxCell>
        <mxCell id="tbl-packages" value="&lt;b&gt;errata_packages&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:8px&quot;&gt;package_name, fixed_version&lt;br&gt;release_name&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#6C8EBF;align=left;spacingLeft=5;verticalAlign=top;spacingTop=5;" parent="1" vertex="1">
          <mxGeometry x="55" y="465" width="130" height="50" as="geometry" />
        </mxCell>
        <mxCell id="tbl-oval" value="&lt;b&gt;oval_definitions&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:8px&quot;&gt;50,862 records&lt;br&gt;oval_id, platform, cve_refs&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#6C8EBF;align=left;spacingLeft=5;verticalAlign=top;spacingTop=5;" parent="1" vertex="1">
          <mxGeometry x="55" y="520" width="130" height="55" as="geometry" />
        </mxCell>
        <mxCell id="tbl-cache" value="&lt;b&gt;uyuni_package_cache&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:8px&quot;&gt;140,937 records&lt;br&gt;channel_label, package_id,&lt;br&gt;package_name, version&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#6C8EBF;align=left;spacingLeft=5;verticalAlign=top;spacingTop=5;" parent="1" vertex="1">
          <mxGeometry x="200" y="505" width="130" height="70" as="geometry" />
        </mxCell>
        <mxCell id="tbl-sync-logs" value="&lt;b&gt;sync_logs&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:8px&quot;&gt;sync_type, status,&lt;br&gt;items_processed&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#6C8EBF;align=left;spacingLeft=5;verticalAlign=top;spacingTop=5;" parent="1" vertex="1">
          <mxGeometry x="55" y="580" width="130" height="55" as="geometry" />
        </mxCell>
        <mxCell id="tbl-errata-cves" value="&lt;b&gt;errata_cves&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:8px&quot;&gt;(join table)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#6C8EBF;align=left;spacingLeft=5;verticalAlign=top;spacingTop=5;" parent="1" vertex="1">
          <mxGeometry x="200" y="580" width="130" height="35" as="geometry" />
        </mxCell>

        <!-- DB Connection Arrow -->
        <mxCell id="db-conn" value="" style="endArrow=classic;startArrow=classic;html=1;rounded=0;strokeColor=#6C8EBF;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="340" y="490" as="sourcePoint" />
            <mxPoint x="400" y="490" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="db-conn-label" value="&lt;font style=&quot;font-size:8px&quot;&gt;psycopg2&lt;br&gt;(RealDictCursor)&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="340" y="510" width="60" height="30" as="geometry" />
        </mxCell>

        <!-- UYUNI Server Box -->
        <mxCell id="uyuni-server-box" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#B85450;fillColor=#F8CECC;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1200" y="70" width="200" height="200" as="geometry" />
        </mxCell>
        <mxCell id="uyuni-server-title" value="&lt;b&gt;UYUNI Server&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;10.172.2.17:443&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="1230" y="80" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uyuni-xmlrpc" value="&lt;b&gt;XML-RPC API&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;/rpc/api&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#B85450;" parent="1" vertex="1">
          <mxGeometry x="1220" y="120" width="160" height="35" as="geometry" />
        </mxCell>
        <mxCell id="uyuni-ns-auth" value="&lt;font style=&quot;font-size:8px&quot;&gt;auth.login/logout&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#B85450;" parent="1" vertex="1">
          <mxGeometry x="1220" y="160" width="75" height="25" as="geometry" />
        </mxCell>
        <mxCell id="uyuni-ns-errata" value="&lt;font style=&quot;font-size:8px&quot;&gt;errata.create/publish&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#B85450;" parent="1" vertex="1">
          <mxGeometry x="1300" y="160" width="85" height="25" as="geometry" />
        </mxCell>
        <mxCell id="uyuni-ns-channel" value="&lt;font style=&quot;font-size:8px&quot;&gt;channel.software.*&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#B85450;" parent="1" vertex="1">
          <mxGeometry x="1220" y="190" width="75" height="25" as="geometry" />
        </mxCell>
        <mxCell id="uyuni-ns-system" value="&lt;font style=&quot;font-size:8px&quot;&gt;system.listSystems&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#B85450;" parent="1" vertex="1">
          <mxGeometry x="1300" y="190" width="85" height="25" as="geometry" />
        </mxCell>
        <mxCell id="uyuni-ns-api" value="&lt;font style=&quot;font-size:8px&quot;&gt;api.getVersion&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#B85450;" parent="1" vertex="1">
          <mxGeometry x="1220" y="220" width="165" height="25" as="geometry" />
        </mxCell>

        <!-- UYUNI Connection Arrow -->
        <mxCell id="uyuni-conn" value="" style="endArrow=classic;startArrow=classic;html=1;rounded=0;strokeColor=#B85450;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1145" y="360" as="sourcePoint" />
            <mxPoint x="1220" y="270" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1200" y="360" />
              <mxPoint x="1200" y="270" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uyuni-conn-label" value="&lt;font style=&quot;font-size:8px&quot;&gt;xmlrpc.client&lt;br&gt;SSL (verify=False)&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1200" y="300" width="80" height="30" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#666666;fillColor=#F5F5F5;" parent="1" vertex="1">
          <mxGeometry x="1200" y="490" width="200" height="160" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="&lt;b&gt;Legend&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="1260" y="495" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg-sync" value="&lt;font style=&quot;font-size:9px&quot;&gt;Sync Endpoints&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFE6CC;strokeColor=#D79B00;" parent="1" vertex="1">
          <mxGeometry x="1210" y="520" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg-health" value="&lt;font style=&quot;font-size:9px&quot;&gt;Health/Stats&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;" parent="1" vertex="1">
          <mxGeometry x="1305" y="520" width="85" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg-errata" value="&lt;font style=&quot;font-size:9px&quot;&gt;Errata&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82B366;" parent="1" vertex="1">
          <mxGeometry x="1210" y="545" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg-uyuni" value="&lt;font style=&quot;font-size:9px&quot;&gt;UYUNI&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;" parent="1" vertex="1">
          <mxGeometry x="1305" y="545" width="85" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg-config" value="&lt;font style=&quot;font-size:9px&quot;&gt;Config/Utils&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673A6;" parent="1" vertex="1">
          <mxGeometry x="1210" y="570" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg-db" value="&lt;font style=&quot;font-size:9px&quot;&gt;Database&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;" parent="1" vertex="1">
          <mxGeometry x="1305" y="570" width="85" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg-fixes" value="&lt;font style=&quot;font-size:9px&quot;&gt;&lt;b&gt;FIX Tags:&lt;/b&gt;&lt;br&gt;#1: Version matching&lt;br&gt;#2: OVAL CVE mapping&lt;br&gt;#4: USN incremental&lt;br&gt;#5: DSA auto batch&lt;br&gt;#6: Retry backoff&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1210" y="595" width="180" height="80" as="geometry" />
        </mxCell>

        <!-- Scheduling Info -->
        <mxCell id="sched-box" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#666666;fillColor=#F5F5F5;dashed=1;" parent="1" vertex="1">
          <mxGeometry x="40" y="670" width="300" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sched-title" value="&lt;b&gt;Azure Logic Apps Triggers&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="100" y="675" width="180" height="15" as="geometry" />
        </mxCell>
        <mxCell id="sched-content" value="&lt;font style=&quot;font-size:9px&quot;&gt;USN: Every 6h (00, 06, 12, 18)&lt;br&gt;DSA: Daily 03:00 (timeout 30m)&lt;br&gt;NVD: Daily 04:00 (timeout 30m)&lt;br&gt;OVAL: Weekly Sun 02:00 (timeout 60m)&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="60" y="695" width="270" height="50" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
